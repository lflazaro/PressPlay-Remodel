<Window x:Class="PressPlay.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="clr-namespace:PressPlay"
        xmlns:converters="clr-namespace:PressPlay.Converters"
        xmlns:customcontrols="clr-namespace:PressPlay.CustomControls"
        xmlns:timeline="clr-namespace:PressPlay.Timeline"
        xmlns:svgc="http://sharpvectors.codeplex.com/svgc/"
        mc:Ignorable="d"
        Title="{Binding Title}"
        Height="650" Width="1000"
        MinWidth="900" MinHeight="600"
        Background="#FF1F1F1F">
    <Window.Resources>
        <converters:TimelineSelectedToolToSelectedConverter x:Key="ToolConverter" />
        <converters:ByteArrayToImageConverter           x:Key="ByteArrayConverter" />
        <local:MainWindowViewModel                      x:Key="MainWindowViewModel" />
    </Window.Resources>

    <!-- DataContext via the window‐scoped resource -->
    <Window.DataContext>
        <StaticResource ResourceKey="MainWindowViewModel" />
    </Window.DataContext>

    <!-- KeyBindings -->
    <Window.InputBindings>
        <!-- File -->
        <KeyBinding Modifiers="Ctrl" Key="N"    Command="{Binding NewProjectCommand}" />
        <KeyBinding Modifiers="Ctrl" Key="O"    Command="{Binding OpenProjectCommand}" />
        <KeyBinding Modifiers="Ctrl" Key="S"    Command="{Binding SaveProjectCommand}" />
        <KeyBinding Modifiers="Ctrl+Shift" Key="S" Command="{Binding SaveProjectAsCommand}" />
        <KeyBinding Modifiers="Alt"  Key="F4"   Command="{Binding ExitApplicationCommand}" />
        <!-- Edit -->
        <KeyBinding Modifiers="Ctrl" Key="Z"    Command="{Binding UndoCommand}" />
        <KeyBinding Modifiers="Ctrl" Key="Y"    Command="{Binding RedoCommand}" />
        <KeyBinding Modifiers="Ctrl" Key="X"    Command="{Binding CutCommand}" />
        <KeyBinding Modifiers="Ctrl" Key="C"    Command="{Binding CopyCommand}" />
        <KeyBinding Modifiers="Ctrl" Key="V"    Command="{Binding PasteCommand}" />
        <KeyBinding Modifiers="Ctrl" Key="A"    Command="{Binding SelectAllCommand}" />
        <!-- Playback -->
        <KeyBinding Key="J"    Command="{Binding ProjectRewindCommand}" />
        <KeyBinding Key="Space" Command="{Binding ProjectPlayCommand}" />
        <KeyBinding Key="L"    Command="{Binding ProjectFastForwardCommand}" />
    </Window.InputBindings>


    <!-- MAIN LAYOUT GRID -->
    <Grid Background="#FF2C2C2C">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <!-- Menu -->
            <RowDefinition Height="*" />
            <!-- Main content -->
            <RowDefinition Height="Auto" />
            <!-- Timeline -->
            <RowDefinition Height="Auto" />
            <!-- Status bar -->
        </Grid.RowDefinitions>

        <!-- MENU BAR -->
        <Menu Grid.Row="0" Background="#FF2C2C2C" Foreground="LightGray">
            <MenuItem Header="File">
                <MenuItem Header="New" Command="{Binding NewProjectCommand}" InputGestureText="Ctrl+N" />
                <MenuItem Header="Open" Command="{Binding OpenProjectCommand}" InputGestureText="Ctrl+O" />
                <Separator />
                <MenuItem Header="Save" Command="{Binding SaveProjectCommand}" InputGestureText="Ctrl+S" />
                <MenuItem Header="Save As..." Command="{Binding SaveProjectAsCommand}" InputGestureText="Ctrl+Shift+S" />
                <Separator />
                <MenuItem Header="Recent Projects" ItemsSource="{Binding RecentProjects}" DisplayMemberPath="Name">
                    <MenuItem.ItemContainerStyle>
                        <Style TargetType="MenuItem">
                            <Setter Property="Command" 
                      Value="{Binding DataContext.OpenRecentProjectCommand, RelativeSource={RelativeSource AncestorType=Menu}}" />
                            <Setter Property="CommandParameter" Value="{Binding}" />
                        </Style>
                    </MenuItem.ItemContainerStyle>
                </MenuItem>
                <MenuItem Header="Exit" Command="{Binding ExitApplicationCommand}" />
            </MenuItem>

            <MenuItem Header="Edit">
                <MenuItem Header="Undo" Command="{Binding UndoCommand}" InputGestureText="Ctrl+Z" />
                <MenuItem Header="Redo" Command="{Binding RedoCommand}" InputGestureText="Ctrl+Y" />
                <Separator />
                <MenuItem Header="Cut" Command="{Binding CutCommand}" InputGestureText="Ctrl+X" />
                <MenuItem Header="Copy" Command="{Binding CopyCommand}" InputGestureText="Ctrl+C" />
                <MenuItem Header="Paste" Command="{Binding PasteCommand}" InputGestureText="Ctrl+V" />
                <Separator />
                <MenuItem Header="Select All" Command="{Binding SelectAllCommand}" InputGestureText="Ctrl+A" />
            </MenuItem>

            <MenuItem Header="Project">
                <MenuItem Header="Add Video Track" Command="{Binding AddVideoTrackCommand}" />
                <Separator />
                <MenuItem Header="Export" Command="{Binding ExportProjectCommand}" />
                <Separator />
                <MenuItem Header="Export Step Outline">
                    <MenuItem Header="To PDF" Command="{Binding ExportStepOutlinePdfCommand}" />
                    <MenuItem Header="To XLSX" Command="{Binding ExportStepOutlineXlsxCommand}" />
                </MenuItem>
                <Separator />
                <MenuItem Header="Settings" Command="{Binding ProjectSettingsCommand}" />
            </MenuItem>

            <!-- TIMELINE Menu -->
            <MenuItem Header="Timeline">
                <MenuItem Header="Select Tool"
                  IsChecked="{Binding CurrentProject.SelectedTool,
                              Converter={StaticResource ToolConverter},
                              ConverterParameter={x:Static timeline:TimelineSelectedTool.SelectionTool}}"
                  Command="{Binding SelectToolCommand}"
                  CommandParameter="{x:Static timeline:TimelineSelectedTool.SelectionTool}" />
                <MenuItem Header="Cutting Tool"
                  IsChecked="{Binding CurrentProject.SelectedTool,
                              Converter={StaticResource ToolConverter},
                              ConverterParameter={x:Static timeline:TimelineSelectedTool.CuttingTool}}"
                  Command="{Binding SelectToolCommand}"
                  CommandParameter="{x:Static timeline:TimelineSelectedTool.CuttingTool}" />
                <Separator />
                <MenuItem Header="Add Transition">
                    <MenuItem Header="Fade to White" Command="{Binding AddTransitionCommand}" CommandParameter="FadeToWhite" />
                    <MenuItem Header="Fade to Black" Command="{Binding AddTransitionCommand}" CommandParameter="FadeToBlack" />
                </MenuItem>
            </MenuItem>

            <!-- MONITOR Menu -->
            <MenuItem Header="Monitor">
                <MenuItem Header="Rewind" Command="{Binding ProjectRewindCommand}" InputGestureText="J">
                    <MenuItem.Icon>
                        <svgc:SvgIcon UriSource="/Resources/Icons/rew.svg" Fill="LightGray" Width="13" Height="13" Margin="-8"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Command="{Binding ProjectPlayCommand}" InputGestureText="Space">
                    <MenuItem.Style>
                        <Style TargetType="MenuItem">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding CurrentProject.IsPlaying}" Value="False">
                                    <Setter Property="Header" Value="Play" />
                                    <Setter Property="Icon">
                                        <Setter.Value>
                                            <svgc:SvgIcon UriSource="/Resources/Icons/play.svg" Fill="LightGray" Width="13" Height="13" Margin="-8"/>
                                        </Setter.Value>
                                    </Setter>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding CurrentProject.IsPlaying}" Value="True">
                                    <Setter Property="Header" Value="Pause" />
                                    <Setter Property="Icon">
                                        <Setter.Value>
                                            <svgc:SvgIcon UriSource="/Resources/Icons/pause.svg" Fill="LightGray" Width="13" Height="13" Margin="-8"/>
                                        </Setter.Value>
                                    </Setter>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>
                </MenuItem>
                <MenuItem Header="Fast Forward" Command="{Binding ProjectFastForwardCommand}" InputGestureText="L">
                    <MenuItem.Icon>
                        <svgc:SvgIcon UriSource="/Resources/Icons/ffw.svg" Fill="LightGray" Width="13" Height="13" Margin="-8"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>

            <!-- HELP Menu -->
            <MenuItem Header="Help">
                <MenuItem Header="Report Issue" Command="{Binding ReportIssueCommand}" />
                <Separator />
                <MenuItem Header="Website" Command="{Binding GoToWebsiteCommand}" />
                <MenuItem Header="About" Command="{Binding AboutCommand}" />
            </MenuItem>
        </Menu>
        <!-- END MENU BAR -->

        <!-- MAIN CONTENT AREA -->
        <Grid Grid.Row="1" Background="#FF2C2C2C">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="40*"/>
                <ColumnDefinition Width="2"/>
                <ColumnDefinition Width="60*"/>
            </Grid.ColumnDefinitions>

            <!-- LEFT PANEL (TABS FOR CLIPS, STEP OUTLINE, ETC.) -->
            <Grid Grid.Column="0">
                <TabControl TabStripPlacement="Bottom" BorderThickness="0" Background="#FF2C2C2C" Foreground="LightGray">
                    <!-- Clips Tab -->
                    <TabItem Header="Clips">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <StackPanel Orientation="Horizontal" Margin="-1,0,0,2">
                                <Button Width="90" Height="24" ToolTip="Add media" Command="{Binding AddMediaCommand}" Margin="1,0" Background="#FF3A3A3A" Foreground="LightGray">
                                    <TextBlock Text="Add Media" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                </Button>
                                <Button Width="91" Height="24" ToolTip="Remove selected clips" Command="{Binding RemoveMediaCommand}" Margin="1,0" Background="#FF3A3A3A" Foreground="LightGray">
                                    <TextBlock Text="Remove Media" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                </Button>
                                <Button Content="Add Track" Command="{Binding AddTrackCommand}" Background="#FF3A3A3A" Foreground="LightGray" Width="79" Height="24"/>
                            </StackPanel>
                            <!-- You may replace this with your media library control -->
                            <customcontrols:ProjectClipsControl Grid.Row="1" ItemsSource="{Binding CurrentProject.Clips}" Background="#FF2B2B2B"/>
                        </Grid>
                    </TabItem>

                    <!-- STEP OUTLINE TAB -->
                    <TabItem Header="Step Outline">
                        <Grid Margin="5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <DataGrid Grid.Row="0" ItemsSource="{Binding CurrentProject.StepOutlineEntries}" AutoGenerateColumns="False" CanUserAddRows="False" CanUserDeleteRows="False" IsReadOnly="False" Background="#FF2B2B2B" Foreground="LightGray">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Timecode" Binding="{Binding Timecode}" Width="Auto"/>
                                    <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*"/>
                                </DataGrid.Columns>
                            </DataGrid>
                            <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right">
                                <Button Content="Add Step" Command="{Binding AddOutlineEntryCommand}" Margin="5,0" Background="#FF3A3A3A" Foreground="LightGray"/>
                                <Button Content="Remove Step" Command="{Binding RemoveOutlineEntryCommand}" Margin="5,0" Background="#FF3A3A3A" Foreground="LightGray"/>
                                <Button Content="Export to PDF" Command="{Binding ExportStepOutlinePdfCommand}" Margin="5,0" Background="#FF3A3A3A" Foreground="LightGray"/>
                                <Button Content="Export to XLSX" Command="{Binding ExportStepOutlineXlsxCommand}" Margin="5,0" Background="#FF3A3A3A" Foreground="LightGray"/>
                            </StackPanel>
                        </Grid>
                    </TabItem>
                </TabControl>
            </Grid>

            <!-- GRID SPLITTER -->
            <GridSplitter Grid.Column="1" ResizeDirection="Columns" HorizontalAlignment="Stretch" Background="#FF2C2C2C"/>

            <!-- RIGHT PANEL (PREVIEW) -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <!-- Preview Window -->
                <Border Grid.Row="0" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" BorderBrush="#FF5A5A5A" BorderThickness="1" Margin="2" Background="#FF2B2B2B">
                    <MediaElement x:Name="VideoPreview"
                  VerticalAlignment="Stretch"
                  HorizontalAlignment="Stretch"
                  Stretch="Uniform"
                  LoadedBehavior="Manual"
                  UnloadedBehavior="Manual"
                  ScrubbingEnabled="True"
                  Volume="1.0"/>
                </Border>
                <!-- Transport Controls -->
                <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center" Margin="5" Background="#FF2C2C2C">
                    <ComboBox Margin="5,0" Width="150" ItemsSource="{Binding CurrentProject.PreviewRenderedTranslations}" DisplayMemberPath="Name" SelectedValuePath="Guid" SelectedValue="{Binding CurrentProject.PreviewRenderedTranslation}" Background="#FF3A3A3A" Foreground="LightGray"/>
                    <StackPanel Orientation="Horizontal">
                        <Button Command="{Binding ProjectRewindCommand}" ToolTip="Rewind (J)" Width="30" Padding="5" Margin="1,0" Background="#FF3A3A3A">
                            <svgc:SvgIcon UriSource="/Resources/Icons/rew.svg" Fill="LightGray" Width="13" Height="13" Margin="-8"/>
                        </Button>
                        <Button Command="{Binding ProjectPlayCommand}" Width="30" Padding="5" Margin="1,0" Background="#FF3A3A3A">
                            <svgc:SvgIcon Fill="LightGray" Width="13" Height="13" Margin="-8">
                                <svgc:SvgIcon.Style>
                                    <Style TargetType="svgc:SvgIcon">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding CurrentProject.IsPlaying}" Value="False">
                                                <Setter Property="UriSource" Value="/Resources/Icons/play.svg"/>
                                                <Setter Property="ToolTip" Value="Play (Space)"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding CurrentProject.IsPlaying}" Value="True">
                                                <Setter Property="UriSource" Value="/Resources/Icons/pause.svg"/>
                                                <Setter Property="ToolTip" Value="Pause (Space)"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </svgc:SvgIcon.Style>
                            </svgc:SvgIcon>
                        </Button>
                        <Button Command="{Binding ProjectFastForwardCommand}" ToolTip="Fast Forward (L)" Width="30" Padding="5" Margin="1,0" Background="#FF3A3A3A">
                            <svgc:SvgIcon UriSource="/Resources/Icons/ffw.svg" Fill="LightGray" Width="13" Height="13" Margin="-8"/>
                        </Button>
                    </StackPanel>
                    <TextBlock Text="{Binding CurrentProject.NeedlePositionTime, Mode=OneWay}" VerticalAlignment="Center" Foreground="LightGray" Margin="10,0"/>
                </StackPanel>
            </Grid>
        </Grid>

        <!-- TIMELINE CONTROL (placed below the main content) -->
        <timeline:TimelineControl
    Grid.Row="2"
    Project="{Binding CurrentProject}"
    Height="150"
    HorizontalAlignment="Stretch"
    Background="#FF2C2C2C"/>

        <!-- STATUS BAR -->
        <StatusBar Grid.Row="3" Background="#FF2C2C2C" Foreground="LightGray">
            <StatusBar.ItemsPanel>
                <ItemsPanelTemplate>
                    <DockPanel LastChildFill="False"/>
                </ItemsPanelTemplate>
            </StatusBar.ItemsPanel>
            <StatusBarItem>
                <TextBlock Text="Ready"/>
            </StatusBarItem>
            <!-- TIMELINE ZOOM -->
            <StatusBarItem DockPanel.Dock="Right">
                <Slider Value="{Binding CurrentProject.TimelineZoom}" Width="100" Minimum="1" Maximum="13" TickFrequency="1" Background="#FF3A3A3A"/>
            </StatusBarItem>
            <StatusBarItem DockPanel.Dock="Right">
                <TextBlock Text="{Binding CurrentProject.TimelineZoom, StringFormat=Zoom:{0}}"/>
            </StatusBarItem>
            <StatusBarItem DockPanel.Dock="Right">
                <TextBlock Text="|"/>
            </StatusBarItem>
            <!-- NEEDLE POSITION -->
            <StatusBarItem DockPanel.Dock="Right">
                <TextBlock Text="{Binding CurrentProject.NeedlePositionTime}"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>